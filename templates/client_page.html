<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clients</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>All Clients</h1>
    <table>
        <tr>
            <th>Name</th>
            <th>Surname</th>
            <th>Age</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Number_of_Reservation</th>
            <th>Action</th>
        </tr>
        {% for client in clients %}
        <tr>
            <td>{{ client.name }}</td>
            <td>{{ client.surname }}</td>
            <td>{{ client.age }}</td>
            <td>{{ client.email }}</td>
            <td>{{ client.phone }}</td>
            <td>{{ client.num_reservations }}</td>
            <td>
                <!-- Button to trigger delete client method -->
                <button class="delete-btn" data-id="{{ client.id }}">Delete</button>
                <!-- Button to trigger update client modal -->
                <button class="update-btn" data-id="{{ client.id }}">Update</button>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- JavaScript to handle the AJAX request -->
    <script>
        $(document).ready(function() {
            $(".delete-btn").click(function() {
                var client_id = $(this).data("id");
                // Confirm deletion
                var confirmDelete = confirm("Are you sure you want to delete this client?");
                if (confirmDelete) {
                    // Send DELETE request to delete client
                    $.ajax({
                        type: "DELETE",
                        url: "/api/delete_client/" + client_id,
                        success: function(response) {
                            // Refresh the page after successful deletion
                            window.location.reload();
                        },
                        error: function(xhr, status, error) {
                            alert("Error deleting client: " + error);
                        }
                    });
                }
            });
        });
    </script>

 <!-- JavaScript to handle the update button click event -->
    <script>
        $(document).ready(function() {
            $(".update-btn").click(function() {
                var client_id = $(this).data("id");
                var new_name = prompt("Enter new name:");
                var new_surname = prompt("Enter new surname:");
                var new_age = prompt("Enter new age:");
                var new_email = prompt("Enter new email:");
                var new_phone = prompt("Enter new phone:");

                var updateData = {};
                if (new_name) updateData.name = new_name;
                if (new_surname) updateData.surname = new_surname;
                if (new_age) updateData.age = new_age;
                if (new_email) updateData.email = new_email;
                if (new_phone) updateData.phone = new_phone;

                // Send PUT request to update client
                $.ajax({
                    type: "PUT",
                    url: "/api/update_client/" + client_id,
                    contentType: "application/json",
                    data: JSON.stringify(updateData),
                    success: function(response) {
                        alert(response.message);
                        // Refresh the page after successful update
                        window.location.reload();
                    },
                    error: function(xhr, status, error) {
                        alert("Error updating client: " + error);
                    }
                });
            });
        });
    </script>
</body>
</html>
